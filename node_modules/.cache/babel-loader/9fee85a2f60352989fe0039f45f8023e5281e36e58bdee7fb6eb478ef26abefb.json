{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _createForOfIteratorHelper from\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _asyncToGenerator from\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{toJS}from'mobx';import{addRequest,addSender}from'../../http/chatApi';function handleGroupMessages(_x,_x2,_x3,_x4){return _handleGroupMessages.apply(this,arguments);}function _handleGroupMessages(){_handleGroupMessages=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event,chat,requests,senders){var message,sender,_iterator,_step,key,body,request,res,senderBody,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:message=event.message;if(!message.isGroup){_context.next=39;break;}_context.next=4;return message.getSender();case 4:sender=_context.sent;if(!(sender!==null&&sender!==void 0&&sender.bot)){_context.next=7;break;}return _context.abrupt(\"return\");case 7:_iterator=_createForOfIteratorHelper(chat.keys.list.split(','));_context.prev=8;_iterator.s();case 10:if((_step=_iterator.n()).done){_context.next=31;break;}key=_step.value;if(!message.text.toLowerCase().includes(key.toLowerCase().trim())){_context.next=29;break;}body={text:message.text,sender:sender.id.value.toString(),username:sender.username?'@'+sender.username:sender.firstName,date:message.date,chat:chat._id};_context.next=16;return addRequest(body);case 16:request=_context.sent;chat.requests.push(request);requests.push(request);console.log(toJS(chat.senders));res=chat.senders.find(function(obj){return obj.senderId===sender.id.value.toString();});if(res){_context.next=28;break;}senderBody={username:sender.username?'@'+sender.username:sender.firstName,senderId:sender.id.value.toString(),messages:[],chat:chat._id};_context.next=25;return addSender(senderBody);case 25:data=_context.sent;console.log(data);chat.senders.push(data);case 28:return _context.abrupt(\"break\",31);case 29:_context.next=10;break;case 31:_context.next=36;break;case 33:_context.prev=33;_context.t0=_context[\"catch\"](8);_iterator.e(_context.t0);case 36:_context.prev=36;_iterator.f();return _context.finish(36);case 39:case\"end\":return _context.stop();}},_callee,null,[[8,33,36,39]]);}));return _handleGroupMessages.apply(this,arguments);}export default handleGroupMessages;","map":{"version":3,"names":["toJS","addRequest","addSender","handleGroupMessages","event","chat","requests","senders","message","isGroup","getSender","sender","bot","keys","list","split","key","text","toLowerCase","includes","trim","body","id","value","toString","username","firstName","date","_id","request","push","console","log","res","find","obj","senderId","senderBody","messages","data"],"sources":["C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/src/components/telegram/handleGroupMessages.js"],"sourcesContent":["import { toJS } from 'mobx';\r\nimport { addRequest, addSender } from '../../http/chatApi';\r\n\r\nasync function handleGroupMessages(event, chat, requests, senders) {\r\n  const message = event.message;\r\n  if (message.isGroup) {\r\n    const sender = await message.getSender();\r\n    if (sender?.bot) return;\r\n\r\n    for (const key of chat.keys.list.split(',')) {\r\n      if (message.text.toLowerCase().includes(key.toLowerCase().trim())) {\r\n        const body = {\r\n          text: message.text,\r\n          sender: sender.id.value.toString(),\r\n          username: sender.username ? '@' + sender.username : sender.firstName,\r\n          date: message.date,\r\n          chat: chat._id,\r\n        };\r\n        const request = await addRequest(body);\r\n        chat.requests.push(request);\r\n        requests.push(request);\r\n        console.log(toJS(chat.senders));\r\n        const res = chat.senders.find(\r\n          (obj) => obj.senderId === sender.id.value.toString()\r\n        );\r\n        if (!res) {\r\n          const senderBody = {\r\n            username: sender.username ? '@' + sender.username : sender.firstName,\r\n            senderId: sender.id.value.toString(),\r\n            messages: [],\r\n            chat: chat._id,\r\n          };\r\n          const data = await addSender(senderBody);\r\n          console.log(data);\r\n          chat.senders.push(data);\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default handleGroupMessages;\r\n"],"mappings":"miBAAA,OAASA,IAAI,KAAQ,MAAM,CAC3B,OAASC,UAAU,CAAEC,SAAS,KAAQ,oBAAoB,CAAC,QAE5CC,oBAAmB,mLAAlC,iBAAmCC,KAAK,CAAEC,IAAI,CAAEC,QAAQ,CAAEC,OAAO,2LACzDC,OAAO,CAAGJ,KAAK,CAACI,OAAO,KACzBA,OAAO,CAACC,OAAO,gDACID,QAAO,CAACE,SAAS,EAAE,QAAlCC,MAAM,oBACRA,MAAM,SAANA,MAAM,WAANA,MAAM,CAAEC,GAAG,uGAEGP,IAAI,CAACQ,IAAI,CAACC,IAAI,CAACC,KAAK,CAAC,GAAG,CAAC,+FAAhCC,GAAG,iBACRR,OAAO,CAACS,IAAI,CAACC,WAAW,EAAE,CAACC,QAAQ,CAACH,GAAG,CAACE,WAAW,EAAE,CAACE,IAAI,EAAE,CAAC,0BACzDC,IAAI,CAAG,CACXJ,IAAI,CAAET,OAAO,CAACS,IAAI,CAClBN,MAAM,CAAEA,MAAM,CAACW,EAAE,CAACC,KAAK,CAACC,QAAQ,EAAE,CAClCC,QAAQ,CAAEd,MAAM,CAACc,QAAQ,CAAG,GAAG,CAAGd,MAAM,CAACc,QAAQ,CAAGd,MAAM,CAACe,SAAS,CACpEC,IAAI,CAAEnB,OAAO,CAACmB,IAAI,CAClBtB,IAAI,CAAEA,IAAI,CAACuB,GACb,CAAC,wBACqB3B,WAAU,CAACoB,IAAI,CAAC,SAAhCQ,OAAO,eACbxB,IAAI,CAACC,QAAQ,CAACwB,IAAI,CAACD,OAAO,CAAC,CAC3BvB,QAAQ,CAACwB,IAAI,CAACD,OAAO,CAAC,CACtBE,OAAO,CAACC,GAAG,CAAChC,IAAI,CAACK,IAAI,CAACE,OAAO,CAAC,CAAC,CACzB0B,GAAG,CAAG5B,IAAI,CAACE,OAAO,CAAC2B,IAAI,CAC3B,SAACC,GAAG,QAAKA,IAAG,CAACC,QAAQ,GAAKzB,MAAM,CAACW,EAAE,CAACC,KAAK,CAACC,QAAQ,EAAE,GACrD,IACIS,GAAG,0BACAI,UAAU,CAAG,CACjBZ,QAAQ,CAAEd,MAAM,CAACc,QAAQ,CAAG,GAAG,CAAGd,MAAM,CAACc,QAAQ,CAAGd,MAAM,CAACe,SAAS,CACpEU,QAAQ,CAAEzB,MAAM,CAACW,EAAE,CAACC,KAAK,CAACC,QAAQ,EAAE,CACpCc,QAAQ,CAAE,EAAE,CACZjC,IAAI,CAAEA,IAAI,CAACuB,GACb,CAAC,wBACkB1B,UAAS,CAACmC,UAAU,CAAC,SAAlCE,IAAI,eACVR,OAAO,CAACC,GAAG,CAACO,IAAI,CAAC,CACjBlC,IAAI,CAACE,OAAO,CAACuB,IAAI,CAACS,IAAI,CAAC,CAAC,wUAMjC,sDAED,cAAepC,oBAAmB"},"metadata":{},"sourceType":"module","externalDependencies":[]}