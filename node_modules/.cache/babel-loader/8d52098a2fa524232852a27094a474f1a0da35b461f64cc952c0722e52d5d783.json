{"ast":null,"code":"\"use strict\";\n\nvar _inherits = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nvar _regeneratorRuntime = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _createForOfIteratorHelper = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _asyncToGenerator = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar _classCallCheck = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/createClass.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ConnectionTCPObfuscated = void 0;\nvar buffer_1 = require(\"buffer/\");\nvar Helpers_1 = require(\"../../Helpers\");\nvar Connection_1 = require(\"./Connection\");\nvar TCPAbridged_1 = require(\"./TCPAbridged\");\nvar CTR_1 = require(\"../../crypto/CTR\");\nvar ObfuscatedIO = /*#__PURE__*/function () {\n  function ObfuscatedIO(connection) {\n    _classCallCheck(this, ObfuscatedIO);\n    this.header = undefined;\n    this.connection = connection.socket;\n    this._packetClass = connection.PacketCodecClass;\n  }\n  _createClass(ObfuscatedIO, [{\n    key: \"initHeader\",\n    value: function () {\n      var _initHeader = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var keywords, random, ok, _iterator, _step, key, randomReversed, encryptKey, encryptIv, decryptKey, decryptIv, encryptor, decryptor;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              // Obfuscated messages secrets cannot start with any of these\n              keywords = [buffer_1.Buffer.from(\"50567247\", \"hex\"), buffer_1.Buffer.from(\"474554\", \"hex\"), buffer_1.Buffer.from(\"504f5354\", \"hex\"), buffer_1.Buffer.from(\"eeeeeeee\", \"hex\")];\n            case 1:\n              if (!true) {\n                _context.next = 27;\n                break;\n              }\n              random = (0, Helpers_1.generateRandomBytes)(64);\n              if (!(random[0] !== 0xef && !random.slice(4, 8).equals(buffer_1.Buffer.alloc(4)))) {\n                _context.next = 25;\n                break;\n              }\n              ok = true;\n              _iterator = _createForOfIteratorHelper(keywords);\n              _context.prev = 6;\n              _iterator.s();\n            case 8:\n              if ((_step = _iterator.n()).done) {\n                _context.next = 15;\n                break;\n              }\n              key = _step.value;\n              if (!key.equals(random.slice(0, 4))) {\n                _context.next = 13;\n                break;\n              }\n              ok = false;\n              return _context.abrupt(\"break\", 15);\n            case 13:\n              _context.next = 8;\n              break;\n            case 15:\n              _context.next = 20;\n              break;\n            case 17:\n              _context.prev = 17;\n              _context.t0 = _context[\"catch\"](6);\n              _iterator.e(_context.t0);\n            case 20:\n              _context.prev = 20;\n              _iterator.f();\n              return _context.finish(20);\n            case 23:\n              if (!ok) {\n                _context.next = 25;\n                break;\n              }\n              return _context.abrupt(\"break\", 27);\n            case 25:\n              _context.next = 1;\n              break;\n            case 27:\n              random = random.toJSON().data;\n              randomReversed = buffer_1.Buffer.from(random.slice(8, 56)).reverse(); // Encryption has \"continuous buffer\" enabled\n              encryptKey = buffer_1.Buffer.from(random.slice(8, 40));\n              encryptIv = buffer_1.Buffer.from(random.slice(40, 56));\n              decryptKey = buffer_1.Buffer.from(randomReversed.slice(0, 32));\n              decryptIv = buffer_1.Buffer.from(randomReversed.slice(32, 48));\n              encryptor = new CTR_1.CTR(encryptKey, encryptIv);\n              decryptor = new CTR_1.CTR(decryptKey, decryptIv);\n              random = buffer_1.Buffer.concat([buffer_1.Buffer.from(random.slice(0, 56)), this._packetClass.obfuscateTag, buffer_1.Buffer.from(random.slice(60))]);\n              random = buffer_1.Buffer.concat([buffer_1.Buffer.from(random.slice(0, 56)), buffer_1.Buffer.from(encryptor.encrypt(random).slice(56, 64)), buffer_1.Buffer.from(random.slice(64))]);\n              this.header = random;\n              this._encrypt = encryptor;\n              this._decrypt = decryptor;\n            case 40:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[6, 17, 20, 23]]);\n      }));\n      function initHeader() {\n        return _initHeader.apply(this, arguments);\n      }\n      return initHeader;\n    }()\n  }, {\n    key: \"read\",\n    value: function () {\n      var _read = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(n) {\n        var data;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return this.connection.readExactly(n);\n            case 2:\n              data = _context2.sent;\n              return _context2.abrupt(\"return\", this._decrypt.encrypt(data));\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function read(_x) {\n        return _read.apply(this, arguments);\n      }\n      return read;\n    }()\n  }, {\n    key: \"write\",\n    value: function write(data) {\n      this.connection.write(this._encrypt.encrypt(data));\n    }\n  }]);\n  return ObfuscatedIO;\n}();\nvar ConnectionTCPObfuscated = /*#__PURE__*/function (_Connection_1$Obfusca) {\n  _inherits(ConnectionTCPObfuscated, _Connection_1$Obfusca);\n  var _super = _createSuper(ConnectionTCPObfuscated);\n  function ConnectionTCPObfuscated() {\n    var _this;\n    _classCallCheck(this, ConnectionTCPObfuscated);\n    _this = _super.apply(this, arguments);\n    _this.ObfuscatedIO = ObfuscatedIO;\n    _this.PacketCodecClass = TCPAbridged_1.AbridgedPacketCodec;\n    return _this;\n  }\n  return _createClass(ConnectionTCPObfuscated);\n}(Connection_1.ObfuscatedConnection);\nexports.ConnectionTCPObfuscated = ConnectionTCPObfuscated;","map":{"version":3,"names":["Object","defineProperty","exports","value","ConnectionTCPObfuscated","buffer_1","require","Helpers_1","Connection_1","TCPAbridged_1","CTR_1","ObfuscatedIO","connection","header","undefined","socket","_packetClass","PacketCodecClass","keywords","Buffer","from","random","generateRandomBytes","slice","equals","alloc","ok","key","toJSON","data","randomReversed","reverse","encryptKey","encryptIv","decryptKey","decryptIv","encryptor","CTR","decryptor","concat","obfuscateTag","encrypt","_encrypt","_decrypt","n","readExactly","write","arguments","AbridgedPacketCodec","ObfuscatedConnection"],"sources":["C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/telegram/network/connection/TCPObfuscated.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ConnectionTCPObfuscated = void 0;\r\nconst buffer_1 = require(\"buffer/\");\r\nconst Helpers_1 = require(\"../../Helpers\");\r\nconst Connection_1 = require(\"./Connection\");\r\nconst TCPAbridged_1 = require(\"./TCPAbridged\");\r\nconst CTR_1 = require(\"../../crypto/CTR\");\r\nclass ObfuscatedIO {\r\n    constructor(connection) {\r\n        this.header = undefined;\r\n        this.connection = connection.socket;\r\n        this._packetClass = connection.PacketCodecClass;\r\n    }\r\n    async initHeader() {\r\n        // Obfuscated messages secrets cannot start with any of these\r\n        const keywords = [\r\n            buffer_1.Buffer.from(\"50567247\", \"hex\"),\r\n            buffer_1.Buffer.from(\"474554\", \"hex\"),\r\n            buffer_1.Buffer.from(\"504f5354\", \"hex\"),\r\n            buffer_1.Buffer.from(\"eeeeeeee\", \"hex\"),\r\n        ];\r\n        let random;\r\n        // eslint-disable-next-line no-constant-condition\r\n        while (true) {\r\n            random = (0, Helpers_1.generateRandomBytes)(64);\r\n            if (random[0] !== 0xef &&\r\n                !random.slice(4, 8).equals(buffer_1.Buffer.alloc(4))) {\r\n                let ok = true;\r\n                for (const key of keywords) {\r\n                    if (key.equals(random.slice(0, 4))) {\r\n                        ok = false;\r\n                        break;\r\n                    }\r\n                }\r\n                if (ok) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        random = random.toJSON().data;\r\n        const randomReversed = buffer_1.Buffer.from(random.slice(8, 56)).reverse();\r\n        // Encryption has \"continuous buffer\" enabled\r\n        const encryptKey = buffer_1.Buffer.from(random.slice(8, 40));\r\n        const encryptIv = buffer_1.Buffer.from(random.slice(40, 56));\r\n        const decryptKey = buffer_1.Buffer.from(randomReversed.slice(0, 32));\r\n        const decryptIv = buffer_1.Buffer.from(randomReversed.slice(32, 48));\r\n        const encryptor = new CTR_1.CTR(encryptKey, encryptIv);\r\n        const decryptor = new CTR_1.CTR(decryptKey, decryptIv);\r\n        random = buffer_1.Buffer.concat([\r\n            buffer_1.Buffer.from(random.slice(0, 56)),\r\n            this._packetClass.obfuscateTag,\r\n            buffer_1.Buffer.from(random.slice(60)),\r\n        ]);\r\n        random = buffer_1.Buffer.concat([\r\n            buffer_1.Buffer.from(random.slice(0, 56)),\r\n            buffer_1.Buffer.from(encryptor.encrypt(random).slice(56, 64)),\r\n            buffer_1.Buffer.from(random.slice(64)),\r\n        ]);\r\n        this.header = random;\r\n        this._encrypt = encryptor;\r\n        this._decrypt = decryptor;\r\n    }\r\n    async read(n) {\r\n        const data = await this.connection.readExactly(n);\r\n        return this._decrypt.encrypt(data);\r\n    }\r\n    write(data) {\r\n        this.connection.write(this._encrypt.encrypt(data));\r\n    }\r\n}\r\nclass ConnectionTCPObfuscated extends Connection_1.ObfuscatedConnection {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.ObfuscatedIO = ObfuscatedIO;\r\n        this.PacketCodecClass = TCPAbridged_1.AbridgedPacketCodec;\r\n    }\r\n}\r\nexports.ConnectionTCPObfuscated = ConnectionTCPObfuscated;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}