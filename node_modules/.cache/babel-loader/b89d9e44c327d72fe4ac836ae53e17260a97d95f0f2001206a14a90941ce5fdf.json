{"ast":null,"code":"import _toConsumableArray from\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{observer}from'mobx-react-lite';import React,{useContext,useEffect,useState}from'react';import{Button,Form,Modal}from'react-bootstrap';import{Context}from'../../..';import{createChats}from'../../../http/chatApi';import CreateKeys from'../CreateKeys';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CreateChat=observer(function(_ref){var show=_ref.show,_onHide=_ref.onHide;var _useContext=useContext(Context),telegramService=_useContext.telegramService,keysStore=_useContext.keysStore;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),uploadedChats=_useState2[0],setUploadedChats=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showKeys=_useState4[0],setShowKeys=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),selectedKey=_useState6[0],setSelectedKey=_useState6[1];var _useContext2=useContext(Context),userStore=_useContext2.userStore;var readFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var reader;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:e.preventDefault();reader=new FileReader();reader.onload=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var text;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:text=e.target.result;setUploadedChats(text.split('\\r\\n'));case 2:case\"end\":return _context.stop();}},_callee);}));return function(_x2){return _ref3.apply(this,arguments);};}();reader.readAsText(e.target.files[0]);case 4:case\"end\":return _context2.stop();}},_callee2);}));return function readFile(_x){return _ref2.apply(this,arguments);};}();var createChat=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var body,resp;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:body=uploadedChats.map(function(chat){return{link:chat,user:userStore.user.id,keys:selectedKey};});_context3.next=3;return createChats(body);case 3:resp=_context3.sent;telegramService.chats=[].concat(_toConsumableArray(telegramService.chats),_toConsumableArray(resp));_onHide();case 6:case\"end\":return _context3.stop();}},_callee3);}));return function createChat(){return _ref4.apply(this,arguments);};}();useEffect(function(){keysStore.fetchKeys();},[show]);return/*#__PURE__*/_jsxs(Modal,{size:\"lg\",show:show,onHide:function onHide(){return _onHide();},\"aria-labelledby\":\"example-modal-sizes-title-lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{id:\"example-modal-sizes-title-lg\",children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0447\\u0430\\u0442\\u044B\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u043D\\u0430\\u0431\\u043E\\u0440 \\u043A\\u043B\\u044E\\u0447\\u0435\\u0439:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex mb-2\",children:[/*#__PURE__*/_jsxs(Form.Select,{onChange:function onChange(e){return setSelectedKey(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u043A\\u043B\\u044E\\u0447\"}),keysStore.keys.map(function(key,index){return/*#__PURE__*/_jsx(\"option\",{value:key.id,children:\"\".concat(key.title,\" - \").concat(key.list)},index);})]}),/*#__PURE__*/_jsx(Button,{className:\"ms-3\",variant:\"primary\",onClick:function onClick(){return setShowKeys(true);},children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C\"})]})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u0435 \\u0441\\u043F\\u0438\\u0441\\u043E\\u043A \\u0447\\u0430\\u0442\\u043E\\u0432:\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"file\",onChange:function onChange(e){return readFile(e);}})]}),/*#__PURE__*/_jsx(Form.Group,{className:\"d-grid pt-4 pb-3\",children:/*#__PURE__*/_jsx(Button,{variant:\"primary\",size:\"lg\",onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",createChat());case 1:case\"end\":return _context4.stop();}},_callee4);})),children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{variant:\"secondary\",size:\"lg\",onClick:function onClick(){return _onHide();},children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})})]}),/*#__PURE__*/_jsx(CreateKeys,{show:showKeys,handleClose:function handleClose(){return setShowKeys(false);}})]});});export default CreateChat;","map":{"version":3,"names":["observer","React","useContext","useEffect","useState","Button","Form","Modal","Context","createChats","CreateKeys","CreateChat","show","onHide","telegramService","keysStore","uploadedChats","setUploadedChats","showKeys","setShowKeys","selectedKey","setSelectedKey","userStore","readFile","e","preventDefault","reader","FileReader","onload","text","target","result","split","readAsText","files","createChat","body","map","chat","link","user","id","keys","resp","chats","fetchKeys","value","key","index","title","list"],"sources":["C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/src/components/modals/monitoring/CreateChat.js"],"sourcesContent":["import { observer } from 'mobx-react-lite';\r\nimport React, { useContext, useEffect, useState } from 'react';\r\nimport { Button, Form, Modal } from 'react-bootstrap';\r\nimport { Context } from '../../..';\r\nimport { createChats } from '../../../http/chatApi';\r\nimport CreateKeys from '../CreateKeys';\r\n\r\nconst CreateChat = observer(({ show, onHide }) => {\r\n  const { telegramService, keysStore } = useContext(Context);\r\n\r\n  const [uploadedChats, setUploadedChats] = useState([]);\r\n  const [showKeys, setShowKeys] = useState(false);\r\n  const [selectedKey, setSelectedKey] = useState({});\r\n  const { userStore } = useContext(Context);\r\n\r\n  const readFile = async (e) => {\r\n    e.preventDefault();\r\n    const reader = new FileReader();\r\n    reader.onload = async (e) => {\r\n      const text = e.target.result;\r\n      setUploadedChats(text.split('\\r\\n'));\r\n    };\r\n    reader.readAsText(e.target.files[0]);\r\n  };\r\n\r\n  const createChat = async () => {\r\n    const body = uploadedChats.map((chat) => ({\r\n      link: chat,\r\n      user: userStore.user.id,\r\n      keys: selectedKey,\r\n    }));\r\n    const resp = await createChats(body);\r\n    telegramService.chats = [...telegramService.chats, ...resp];\r\n    onHide();\r\n  };\r\n\r\n  useEffect(() => {\r\n    keysStore.fetchKeys();\r\n  }, [show]);\r\n\r\n  return (\r\n    <Modal\r\n      size=\"lg\"\r\n      show={show}\r\n      onHide={() => onHide()}\r\n      aria-labelledby=\"example-modal-sizes-title-lg\"\r\n    >\r\n      <Modal.Header closeButton>\r\n        <Modal.Title id=\"example-modal-sizes-title-lg\">\r\n          Добавить чаты\r\n        </Modal.Title>\r\n      </Modal.Header>\r\n      <Modal.Body>\r\n        <Form.Group>\r\n          <Form.Label>Выберите набор ключей:</Form.Label>\r\n          <div className=\"d-flex mb-2\">\r\n            <Form.Select onChange={(e) => setSelectedKey(e.target.value)}>\r\n              <option>Выберите ключ</option>\r\n              {keysStore.keys.map((key, index) => (\r\n                <option\r\n                  key={index}\r\n                  value={key.id}\r\n                >{`${key.title} - ${key.list}`}</option>\r\n              ))}\r\n            </Form.Select>\r\n            <Button\r\n              className=\"ms-3\"\r\n              variant=\"primary\"\r\n              onClick={() => setShowKeys(true)}\r\n            >\r\n              Добавить\r\n            </Button>\r\n          </div>\r\n        </Form.Group>\r\n        <Form.Group>\r\n          <Form.Label>Загрузите список чатов:</Form.Label>\r\n          <Form.Control type=\"file\" onChange={(e) => readFile(e)} />\r\n        </Form.Group>\r\n\r\n        <Form.Group className=\"d-grid pt-4 pb-3\">\r\n          <Button\r\n            variant=\"primary\"\r\n            size=\"lg\"\r\n            onClick={async () => createChat()}\r\n          >\r\n            Добавить\r\n          </Button>\r\n        </Form.Group>\r\n        <div className=\"d-grid\">\r\n          <Button variant=\"secondary\" size=\"lg\" onClick={() => onHide()}>\r\n            Закрыть\r\n          </Button>\r\n        </div>\r\n      </Modal.Body>\r\n      <CreateKeys show={showKeys} handleClose={() => setShowKeys(false)} />\r\n    </Modal>\r\n  );\r\n});\r\n\r\nexport default CreateChat;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}