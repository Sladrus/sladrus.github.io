{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar _classCallCheck = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/@babel/runtime/helpers/createClass.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthKey = void 0;\nvar buffer_1 = require(\"buffer/\");\nvar Helpers_1 = require(\"../Helpers\");\nvar extensions_1 = require(\"../extensions\");\nvar Helpers_2 = require(\"../Helpers\");\nvar AuthKey = /*#__PURE__*/function () {\n  function AuthKey(value, hash) {\n    _classCallCheck(this, AuthKey);\n    if (!hash || !value) {\n      return;\n    }\n    this._key = value;\n    this._hash = hash;\n    var reader = new extensions_1.BinaryReader(hash);\n    this.auxHash = reader.readLong(false);\n    reader.read(4);\n    this.keyId = reader.readLong(false);\n  }\n  _createClass(AuthKey, [{\n    key: \"setKey\",\n    value: function () {\n      var _setKey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(value) {\n        var reader;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (value) {\n                _context.next = 3;\n                break;\n              }\n              this._key = this.auxHash = this.keyId = this._hash = undefined;\n              return _context.abrupt(\"return\");\n            case 3:\n              if (!(value instanceof AuthKey)) {\n                _context.next = 9;\n                break;\n              }\n              this._key = value._key;\n              this.auxHash = value.auxHash;\n              this.keyId = value.keyId;\n              this._hash = value._hash;\n              return _context.abrupt(\"return\");\n            case 9:\n              this._key = value;\n              _context.next = 12;\n              return (0, Helpers_1.sha1)(this._key);\n            case 12:\n              this._hash = _context.sent;\n              reader = new extensions_1.BinaryReader(this._hash);\n              this.auxHash = reader.readLong(false);\n              reader.read(4);\n              this.keyId = reader.readLong(false);\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function setKey(_x) {\n        return _setKey.apply(this, arguments);\n      }\n      return setKey;\n    }()\n  }, {\n    key: \"waitForKey\",\n    value: function () {\n      var _waitForKey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (this.keyId) {\n                _context2.next = 5;\n                break;\n              }\n              _context2.next = 3;\n              return (0, Helpers_2.sleep)(20);\n            case 3:\n              _context2.next = 0;\n              break;\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function waitForKey() {\n        return _waitForKey.apply(this, arguments);\n      }\n      return waitForKey;\n    }()\n  }, {\n    key: \"getKey\",\n    value: function getKey() {\n      return this._key;\n    }\n    // TODO : This doesn't really fit here, it's only used in authentication\n    /**\r\n     * Calculates the new nonce hash based on the current class fields' values\r\n     * @param newNonce\r\n     * @param number\r\n     * @returns {bigInt.BigInteger}\r\n     */\n  }, {\n    key: \"calcNewNonceHash\",\n    value: function () {\n      var _calcNewNonceHash = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(newNonce, number) {\n        var nonce, n, data, shaData;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!this.auxHash) {\n                _context3.next = 9;\n                break;\n              }\n              nonce = (0, Helpers_1.toSignedLittleBuffer)(newNonce, 32);\n              n = buffer_1.Buffer.alloc(1);\n              n.writeUInt8(number, 0);\n              data = buffer_1.Buffer.concat([nonce, buffer_1.Buffer.concat([n, (0, Helpers_1.readBufferFromBigInt)(this.auxHash, 8, true)])]); // Calculates the message key from the given data\n              _context3.next = 7;\n              return (0, Helpers_1.sha1)(data);\n            case 7:\n              shaData = _context3.sent.slice(4, 20);\n              return _context3.abrupt(\"return\", (0, Helpers_1.readBigIntFromBuffer)(shaData, true, true));\n            case 9:\n              throw new Error(\"Auth key not set\");\n            case 10:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function calcNewNonceHash(_x2, _x3) {\n        return _calcNewNonceHash.apply(this, arguments);\n      }\n      return calcNewNonceHash;\n    }()\n  }, {\n    key: \"equals\",\n    value: function equals(other) {\n      var _a;\n      return other instanceof this.constructor && this._key && buffer_1.Buffer.isBuffer(other.getKey()) && ((_a = other.getKey()) === null || _a === void 0 ? void 0 : _a.equals(this._key));\n    }\n  }]);\n  return AuthKey;\n}();\nexports.AuthKey = AuthKey;","map":{"version":3,"names":["Object","defineProperty","exports","value","AuthKey","buffer_1","require","Helpers_1","extensions_1","Helpers_2","hash","_key","_hash","reader","BinaryReader","auxHash","readLong","read","keyId","undefined","sha1","sleep","newNonce","number","nonce","toSignedLittleBuffer","n","Buffer","alloc","writeUInt8","data","concat","readBufferFromBigInt","shaData","slice","readBigIntFromBuffer","Error","other","_a","constructor","isBuffer","getKey","equals"],"sources":["C:/Users/Yakov/Desktop/projects/node-projects/node-js-key-monitor/sladrus.github.io/node_modules/telegram/crypto/AuthKey.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.AuthKey = void 0;\r\nconst buffer_1 = require(\"buffer/\");\r\nconst Helpers_1 = require(\"../Helpers\");\r\nconst extensions_1 = require(\"../extensions\");\r\nconst Helpers_2 = require(\"../Helpers\");\r\nclass AuthKey {\r\n    constructor(value, hash) {\r\n        if (!hash || !value) {\r\n            return;\r\n        }\r\n        this._key = value;\r\n        this._hash = hash;\r\n        const reader = new extensions_1.BinaryReader(hash);\r\n        this.auxHash = reader.readLong(false);\r\n        reader.read(4);\r\n        this.keyId = reader.readLong(false);\r\n    }\r\n    async setKey(value) {\r\n        if (!value) {\r\n            this._key = this.auxHash = this.keyId = this._hash = undefined;\r\n            return;\r\n        }\r\n        if (value instanceof AuthKey) {\r\n            this._key = value._key;\r\n            this.auxHash = value.auxHash;\r\n            this.keyId = value.keyId;\r\n            this._hash = value._hash;\r\n            return;\r\n        }\r\n        this._key = value;\r\n        this._hash = await (0, Helpers_1.sha1)(this._key);\r\n        const reader = new extensions_1.BinaryReader(this._hash);\r\n        this.auxHash = reader.readLong(false);\r\n        reader.read(4);\r\n        this.keyId = reader.readLong(false);\r\n    }\r\n    async waitForKey() {\r\n        while (!this.keyId) {\r\n            await (0, Helpers_2.sleep)(20);\r\n        }\r\n    }\r\n    getKey() {\r\n        return this._key;\r\n    }\r\n    // TODO : This doesn't really fit here, it's only used in authentication\r\n    /**\r\n     * Calculates the new nonce hash based on the current class fields' values\r\n     * @param newNonce\r\n     * @param number\r\n     * @returns {bigInt.BigInteger}\r\n     */\r\n    async calcNewNonceHash(newNonce, number) {\r\n        if (this.auxHash) {\r\n            const nonce = (0, Helpers_1.toSignedLittleBuffer)(newNonce, 32);\r\n            const n = buffer_1.Buffer.alloc(1);\r\n            n.writeUInt8(number, 0);\r\n            const data = buffer_1.Buffer.concat([\r\n                nonce,\r\n                buffer_1.Buffer.concat([n, (0, Helpers_1.readBufferFromBigInt)(this.auxHash, 8, true)]),\r\n            ]);\r\n            // Calculates the message key from the given data\r\n            const shaData = (await (0, Helpers_1.sha1)(data)).slice(4, 20);\r\n            return (0, Helpers_1.readBigIntFromBuffer)(shaData, true, true);\r\n        }\r\n        throw new Error(\"Auth key not set\");\r\n    }\r\n    equals(other) {\r\n        var _a;\r\n        return (other instanceof this.constructor &&\r\n            this._key &&\r\n            buffer_1.Buffer.isBuffer(other.getKey()) &&\r\n            ((_a = other.getKey()) === null || _a === void 0 ? void 0 : _a.equals(this._key)));\r\n    }\r\n}\r\nexports.AuthKey = AuthKey;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}